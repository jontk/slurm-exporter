global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'slurm-exporter-sandbox@example.com'

# Routes for tutorial alerts
route:
  group_by: ['alertname', 'cluster', 'tutorial']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'sandbox-default'
  routes:
    # Tutorial-specific routing
    - match:
        tutorial: basic
      receiver: 'tutorial-basic'
      group_wait: 5s
      repeat_interval: 30m
    
    - match:
        tutorial: monitoring
      receiver: 'tutorial-monitoring'
      group_wait: 5s
      repeat_interval: 30m
    
    - match:
        tutorial: troubleshooting
      receiver: 'tutorial-troubleshooting'
      group_wait: 5s
      repeat_interval: 15m
    
    - match:
        tutorial: optimization
      receiver: 'tutorial-optimization'
      group_wait: 10s
      repeat_interval: 1h
    
    # Severity-based routing
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
    
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 30m
    
    - match:
        severity: info
      receiver: 'info-alerts'
      repeat_interval: 2h

receivers:
  # Default sandbox receiver
  - name: 'sandbox-default'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/default'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'sandbox'
            password: 'tutorial'

  # Tutorial-specific receivers
  - name: 'tutorial-basic'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/tutorial/basic'
        send_resolved: true
        title: 'üéì Tutorial Alert: {{ .GroupLabels.alertname }}'
        text: |
          Tutorial: Basic Setup
          
          Alert: {{ .GroupLabels.alertname }}
          
          {{ range .Alerts }}
          Description: {{ .Annotations.description }}
          Runbook: {{ .Annotations.runbook_url }}
          {{ end }}
          
          üí° This is a great learning opportunity! Check the tutorial links above.

  - name: 'tutorial-monitoring'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/tutorial/monitoring'
        send_resolved: true
        title: 'üìä Monitoring Tutorial: {{ .GroupLabels.alertname }}'
        text: |
          Tutorial: Monitoring & Alerting
          
          {{ range .Alerts }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          Dashboard: {{ .Annotations.dashboard_url }}
          {{ end }}

  - name: 'tutorial-troubleshooting'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/tutorial/troubleshooting'
        send_resolved: true
        title: 'üîß Troubleshooting Practice: {{ .GroupLabels.alertname }}'
        text: |
          Tutorial: Troubleshooting
          
          {{ range .Alerts }}
          Issue: {{ .Annotations.summary }}
          Details: {{ .Annotations.description }}
          Troubleshooting Guide: {{ .Annotations.runbook_url }}
          {{ end }}
          
          üõ†Ô∏è Use this as practice for the troubleshooting tutorial!

  - name: 'tutorial-optimization'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/tutorial/optimization'
        send_resolved: true
        title: '‚ö° Performance Tutorial: {{ .GroupLabels.alertname }}'
        text: |
          Tutorial: Performance Optimization
          
          {{ range .Alerts }}
          Performance Issue: {{ .Annotations.summary }}
          Impact: {{ .Annotations.description }}
          Tutorial: {{ .Annotations.runbook_url }}
          {{ end }}

  # Severity-based receivers
  - name: 'critical-alerts'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/critical'
        send_resolved: true
        title: 'üö® CRITICAL: {{ .GroupLabels.alertname }}'
        text: |
          CRITICAL ALERT in Sandbox Environment
          
          {{ range .Alerts }}
          Summary: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          Component: {{ .Labels.component }}
          {{ end }}
          
          This is a simulated critical alert for learning purposes.

  - name: 'warning-alerts'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/warning'
        send_resolved: true
        title: '‚ö†Ô∏è WARNING: {{ .GroupLabels.alertname }}'
        text: |
          Warning Alert in Sandbox
          
          {{ range .Alerts }}
          Summary: {{ .Annotations.summary }}
          Component: {{ .Labels.component }}
          {{ end }}

  - name: 'info-alerts'
    webhook_configs:
      - url: 'http://tutorial-server/api/alerts/info'
        send_resolved: true
        title: '‚ÑπÔ∏è INFO: {{ .GroupLabels.alertname }}'
        text: |
          Informational Alert
          
          {{ range .Alerts }}
          Info: {{ .Annotations.summary }}
          {{ end }}

# Inhibition rules for tutorial environment
inhibit_rules:
  # Don't send node alerts if the exporter is down
  - source_match:
      alertname: SlurmExporterDown
    target_match:
      component: infrastructure
    equal: ['cluster']
  
  # Don't send performance alerts if API is unreachable
  - source_match:
      alertname: SlurmApiUnreachable
    target_match:
      component: performance
    equal: ['cluster']

# Templates for custom alert formatting
templates:
  - '/etc/alertmanager/templates/*.tmpl'