# Development Environment Configuration
# This file contains development-specific settings for SLURM Exporter

# Environment metadata
environment:
  name: development
  cluster: dev-cluster
  region: us-west-2
  compliance_level: none
  security_tier: development

# SLURM cluster configuration
slurm:
  clusters:
    dev:
      rest_url: "https://slurm-head.dev.example.com:6820"
      auth_type: jwt
      timeout: 30s
      retry_count: 2
      retry_delay: 2s
      max_concurrent_requests: 3
      rate_limit: 20  # Very low rate limit for dev
      
      # Minimal connection pooling
      connection_pool:
        min_connections: 1
        max_connections: 2
        max_idle_time: 120s
        connection_ttl: 600s

# Server configuration for development
server:
  address: ":8080"
  metrics_path: "/metrics"
  health_path: "/health"
  ready_path: "/ready"
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 60s
  max_request_size: 5242880  # 5MB
  enable_pprof: true  # Always enabled in development
  enable_cors: true
  cors_origins: ["*"]
  
  # No TLS in development
  tls:
    enabled: false

# Verbose logging for development
logging:
  level: "debug"
  format: "console"  # Human-readable format
  output: "stdout"
  enable_caller: true
  enable_stacktrace: true
  
  fields:
    service: "slurm-exporter"
    environment: "development"
    cluster: "dev-cluster"
    version: "${VERSION}"
    developer: "${USER}"

# Collectors configuration optimized for development
collectors:
  jobs:
    enabled: true
    collection_interval: 60s  # Slower collection for development
    timeout: 20s
    max_age: 600s
    
    # All metrics enabled for development testing
    filters:
      metric_filter:
        enable_all: true
        exclude_metrics: []
        skip_histograms: false
        skip_timing_metrics: false
    
    # Very high cardinality limits for testing
    cardinality:
      max_labels: 20000
      sample_rate: 1.0
      max_series_per_label: 500
    
    custom_labels:
      cluster_name: "dev-cluster"
      environment: "development"
      developer: "${USER}"

  nodes:
    enabled: true
    collection_interval: 120s  # Less frequent in dev
    timeout: 30s
    max_age: 1200s
    
    filters:
      metric_filter:
        enable_all: true
    
    cardinality:
      max_labels: 10000
      sample_rate: 1.0
    
    custom_labels:
      cluster_name: "dev-cluster"
      environment: "development"

  partitions:
    enabled: true
    collection_interval: 300s  # Very infrequent in dev
    timeout: 30s
    max_age: 1800s
    
    custom_labels:
      cluster_name: "dev-cluster"
      environment: "development"

  system:
    enabled: true
    collection_interval: 60s
    timeout: 30s
    
    custom_labels:
      cluster_name: "dev-cluster"
      environment: "development"

  performance:
    enabled: true
    collection_interval: 30s
    
    custom_labels:
      instance: "${HOSTNAME}"
      environment: "development"
      developer: "${USER}"

# Minimal performance optimization for development
performance:
  memory_optimizer:
    enabled: false  # Disabled for easier debugging
    gc_percent: 300
    memory_limit: 128MB
    cleanup_interval: 600s
  
  connection_pool:
    enabled: false  # Simplified for development
    min_connections: 1
    max_connections: 2
  
  caching:
    enabled: false  # Disabled to see real-time data
    default_ttl: 10s
    max_size: 100
  
  cardinality_optimizer:
    enabled: false  # Disabled for full metrics access
    max_cardinality: 50000
    sample_rate: 1.0

# Relaxed health checks for development
health:
  enabled: true
  check_interval: 60s  # Less frequent checks
  timeout: 15s
  
  checks:
    - name: "slurm_api"
      type: "http"
      endpoint: "${SLURM_REST_URL}/slurm/v0.0.44/ping"
      timeout: 10s
      headers:
        X-SLURM-USER-TOKEN: "${SLURM_JWT_TOKEN}"
      expected_status: 200
    
    - name: "memory_usage"
      type: "memory"
      threshold: 95  # Very high threshold
    
    - name: "collection_errors"
      type: "error_rate"
      threshold: 50.0  # Very tolerant error rate
      window: 600s

# Minimal security for development
security:
  authentication:
    enabled: false
    type: "none"
  
  rate_limiting:
    enabled: false  # No rate limiting in development
  
  validation:
    max_request_size: 5MB
    allowed_methods: ["GET", "HEAD", "POST", "PUT", "DELETE", "OPTIONS"]
    allowed_paths: ["*"]  # Allow all paths

# Development monitoring
monitoring:
  prometheus:
    enabled: true
    namespace: "slurm_exporter"
    subsystem: "development"
    
    custom_metrics:
      - name: "build_info"
        help: "Build information"
        type: "gauge"
        labels:
          version: "${VERSION}"
          environment: "development"
          cluster: "dev-cluster"
          developer: "${USER}"
  
  # Full tracing enabled for development
  tracing:
    enabled: true
    jaeger_endpoint: "http://localhost:14268/api/traces"
    sample_rate: 1.0  # Trace everything in development

# Development-specific features
features:
  config_validation:
    enabled: true
    strict_mode: false
  
  hot_reload:
    enabled: true
    watch_interval: 5s  # Very frequent for development
    config_paths:
      - "/etc/slurm-exporter/config.yaml"
      - "./config.yaml"
      - "./configs/dev-config.yaml"
  
  graceful_shutdown:
    enabled: false  # Quick restarts in development
    timeout: 5s
    drain_timeout: 1s
  
  circuit_breaker:
    enabled: false  # Disabled for easier debugging

# Minimal resources for development
resources:
  limits:
    cpu: "200m"
    memory: "256Mi"
    ephemeral_storage: "500Mi"
  
  requests:
    cpu: "50m"
    memory: "64Mi"
    ephemeral_storage: "20Mi"

# Development overrides
overrides:
  high_availability:
    enabled: false
    min_replicas: 1
    max_replicas: 1
  
  backup:
    enabled: false
  
  compliance:
    enabled: false
    audit_logging: false
    data_retention: "1d"
    encryption_at_rest: false
    encryption_in_transit: false

# Development integrations
integrations:
  service_mesh:
    enabled: false
  
  secrets_manager:
    enabled: false
  
  log_aggregation:
    enabled: false  # Local logging only
  
  metrics_aggregation:
    enabled: false

# Development-specific settings
development:
  # Enable experimental features
  experimental_features:
    enabled: true
    features:
      - "new_collector_api"
      - "enhanced_metrics"
      - "custom_dashboards"
  
  # Debug endpoints
  debug:
    enabled: true
    endpoints:
      - "/debug/vars"
      - "/debug/pprof/*"
      - "/debug/config"
      - "/debug/collectors"
  
  # Mock data for testing
  mock_data:
    enabled: false  # Set to true for testing without SLURM
    job_count: 100
    node_count: 50
    partition_count: 5
  
  # Development tools
  tools:
    config_generator: true
    metric_explorer: true
    test_data_generator: true
  
  # Auto-reload on code changes
  auto_reload:
    enabled: false  # Set to true for local development
    watch_paths:
      - "./internal/"
      - "./cmd/"
      - "./configs/"
    
  # Local development server
  dev_server:
    enabled: false  # Set to true for local development
    host: "localhost"
    port: 8080
    hot_reload: true